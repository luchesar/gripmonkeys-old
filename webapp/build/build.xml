<project name="cursoconducir" default="none">
    <target name="none">
    </target>

    <target name="deps">
        <property name="deps.js.file" value="${basedir}/../src/main/webapp/deps.js" />
        <exec executable="python" dir="${basedir}" failonerror="true">
            <arg line="${basedir}/closure/depswriter.py" />
            <arg line="--root_with_prefix='../src/main/webapp/pages ../../../pages'" />
            <arg line="--root_with_prefix='../src/main/webapp/jsgen ../../../jsgen'" />
            <arg line="--root_with_prefix='../src/main/webapp/modules ../../../modules'" />
            <arg line="--root_with_prefix='../src/main/webapp/jslib/lib ../../../jslib/lib'" />
            <arg line="--output_file ${deps.js.file}" />
        </exec>
        <echo>${deps.js.file} regenerated</echo>
    </target>

    <target name="soy">
       <property name="templates.js.file" value="'${basedir}/../src/main/webapp/jsgen/{INPUT_FILE_NAME}.js'" />
        <java jar="${basedir}/closure/SoyToJsSrcCompiler.jar" fork="true" failonerror="true">
            <arg line="--shouldGenerateJsdoc"/>
            <arg line="--shouldProvideRequireSoyNamespaces"/>
            <arg line="--outputPathFormat"/>
            <arg line="${templates.js.file}"/>
            <arg line="${basedir}/../src/main/webapp/modules/menu.soy" />
            <arg line="${basedir}/../src/main/webapp/modules/test.soy" />
            <arg line="${basedir}/../src/main/webapp/modules/testPreview.soy" />
            <arg line="${basedir}/../src/main/webapp/modules/allTests.soy" />
        </java>
        <echo>${templates.js.file} regenerated</echo>
        <antcall target="deps"/>
    </target>

    <target name="compile" depends="soy">
        <compile namespace="cursoconducir.IndexPage" outputfile="${basedir}/../src/main/webapp/jsgen/index.compiled.js" />
        <compile namespace="cursoconducir.admin.TestsPage" outputfile="${basedir}/../src/main/webapp/jsgen/adminTests.compiled.js" />
    </target>

    <macrodef name="compile">
        <attribute name="namespace" />
        <attribute name="outputFile" />
        <sequential>
            <exec executable="python" dir="${basedir}/.." failonerror="true">
                <arg line="${basedir}/closure/closurebuilder.py" />
                <arg line="--root=${basedir}/../src/main/webapp/jslib" />
                <arg line="--root=${basedir}/../src/main/webapp/jsgen" />
                <arg line="--root=${basedir}/../src/main/webapp/modules" />
                <arg line="--root=${basedir}/../src/main/webapp/pages" />
                <arg line="--namespace='@{namespace}'" />
                <arg line="--output_mode=compiled" />
                <arg line="--compiler_jar=${basedir}/closure/compiler.jar" />
                <arg line="--compiler_flags='--compilation_level=WHITESPACE_ONLY'" />
                <arg line="--output_file=@{outputFile}" />
            </exec>
            <echo>@{namespace} compiled to @{outputFile}</echo>
        </sequential>
    </macrodef>

    <target name="plovr">
    </target>
</project>